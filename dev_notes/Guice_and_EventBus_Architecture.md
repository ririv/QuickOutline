# Guice (依赖注入) 与事件总线 (Event Bus) 架构说明

本文档旨在解释项目中引入的两个核心架构模式：Guice依赖注入和事件总线，以及它们如何协同工作。

把我们的应用程序想象成一个**正在运作的办公室**。

---

### Guice (依赖注入) 的作用：【人事部和后勤部】

Guice 扮演的是办公室的“人事和后勤”部门，它负责**对象的组装和关系的建立**。

*   **招聘员工 (创建对象)**: 当办公室需要一个“项目经理”（例如 `MainController`）时，我们不再手动创建它 (`new MainController(...)`)。而是告诉Guice：“我需要一个项目经理”。

*   **分配办公用品 (注入依赖)**: Guice会检查“项目经理”的入职要求（即构造函数上的 `@Inject` 注解），发现他需要“一台电脑” (`PdfOutlineService`) 和“一部电话” (`CurrentFileState`)。Guice会自动从“后勤仓库”中找到这些依赖，并将它们分配（注入）给这个项目经理。

*   **管理仓库 (单例模式)**: 在我们的配置中心 (`AppModule`) 中，我们告诉Guice“电话和电脑整个公司只有一台，谁要用都用这台”，这就是单例（Singleton）绑定。Guice会确保所有需要这些服务的对象都拿到同一个实例。

**总结：Guice 的核心作用是在程序启动时，像一个聪明的工厂，帮你创建好所有需要的对象，并处理好它们之间“谁需要谁”的依赖关系。它主要解决的是对象如何被“构建”和“组装”的问题，实现了控制反转（IoC）。**

---

### 事件总线 (Event Bus) 的作用：【公司的公告板/广播系统】

事件总线扮演的是办公室的“内部广播系统”，它负责**对象之间的动态通信**，尤其是在它们不应该直接相互了解的情况下。

*   **发布广播 (发布事件)**: “前台”（`LeftPaneController`）接到一个访客，说想切换到“文本标签页”。前台自己不去带路，她只是打开广播向全公司宣布：“有切换到文本标签页的请求！” (通过 `eventBus.publish(new SwitchTabEvent(FnTab.text))`)。

*   **收听广播 (订阅事件)**: “项目经理”（`MainController`）的桌上一直开着这个广播。当他听到“切换到文本标签页”的广播后，他知道这是自己的职责，于是他开始执行具体的切换界面操作。

*   **互不干扰 (解耦)**: 最关键的是，发布广播的“前台”完全不需要知道办公室里有谁在听，更不需要知道“项目经理”的存在。同样的，“项目经理”也不需要认识“前台”。他们只通过广播系统这一个渠道进行通信。

**总结：事件总线的核心作用是让已经创建好的对象之间，在不直接相互引用的情况下，能够进行通信。它主要解决的是对象之间如何“对话”的问题，实现了彻底的解耦。**

---

### 两者如何协同工作？

1.  **Guice (人事后勤)** 先搭建好整个办公室，为每个员工（对象）配齐了他们工作所需的固定设备（依赖），其中就包括为每个人都安装了一台能接收公司广播的“收音机”（即注入同一个 `AppEventBus` 实例）。

2.  **EventBus (广播系统)** 在大家开始工作后，负责传递动态消息，让不同部门的员工（对象）可以高效协作，而不需要知道对方的“分机号”或“工位在哪”。

通过这种方式，我们构建了一个分工明确、灵活、易于扩展和维护的应用程序。
