---
date: 2026-01-19
title: Safari 下 Input 与 Div 切换导致的高度跳动分析
tags: [frontend, safari, webkit, css, layout]
---

# Safari 下 Input 与 Div 切换导致的高度跳动分析

## 问题描述
在 `BookmarkNode.svelte` 组件中，当点击页码进入编辑状态（从 `div` 切换为 `input`）时，Safari 浏览器中整个行容器会出现 1px 的垂直抖动。Chrome 浏览器中表现正常。

## 环境
- **操作系统**: macOS
- **浏览器**: Safari (WebKit) vs Chrome (Chromium)

## 数据对比 (Safari 测量值)
通过实时调试观察到的计算高度（clientHeight）：
- **Display 模式 (div)**: 21px
- **Edit 模式 (input)**: 22px

虽然两者的 Tailwind CSS 类完全一致（均为 `px-1.5 py-0.5 text-sm leading-tight border border-transparent`），但渲染引擎在处理 `input` 原生组件和普通 `div` 时的默认行高取整、基线对齐策略存在差异。

## 根本原因：布局主导权 (Layout Dominance) 的丧失

### 1. 布局模型
行容器 `node-row` 是一个 `flex items-center` 容器，其总高度由内部最高的元素撑开。

### 2. 问题的产生
- **稳定期**: 早期版本中，左侧的展开/折叠按钮（Button）尺寸为 **24px**。此时，行容器的高度主要受 24px 按钮的主导，行高稳定。
- **触发点**: 在一次重构中，将按钮尺寸缩小到了 **20px**。
- **后果**: 20px 的按钮不再是行内最高的元素。此时，行容器的高度开始由 Page Cell（页码区域）的高度决定。
- **抖动**: 
    - 状态切换时，Page Cell 物理高度从 21px 变为 22px。
    - 作为行内最高元素，它直接撑开了行容器，导致整行高度发生了 1px 的变化。
    - 这种变化向上传递，导致整个树形结构发生视觉抖动。

## 解决方案
**恢复展开按钮的 24px 尺寸。**

通过恢复 24px 的按钮，我们重新建立了“布局主导权”。24px 的高度足以作为“撑杠”锁死行容器的最小高度。即使页码区域内部发生了 1px 的计算差异（21px vs 22px），由于它们都小于 24px，这种差异只会在容器内部被 Flex 居中逻辑吸收，而不会驱动外部容器尺寸的变化，从而彻底消除了视觉抖动。

## 总结与启示
1. **跨浏览器渲染差异**: `input` 和 `div` 即使 CSS 完全相同，在 Safari 等浏览器中也可能存在亚像素级别的渲染差异。
2. **布局锚点 (Layout Anchor)**: 在列表项设计中，保留一个尺寸固定的锚点元素（如 Icon 按钮）有助于维持整体布局的健壮性。
3. **整体观**: 面对局部元素的抖动，除了在元素本身调整 CSS（如强制高度、Flex 居中），检查周围元素的布局主导权往往能提供更优雅的“降维打击”式解决方案。
