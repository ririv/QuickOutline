# QuickOutline Markdown 编辑器使用说明

> 版本：当前功能集（含标题/链接补全、表格辅助、行号选择、快捷键等）  
> 目标读者：使用 QuickOutline 内置 Markdown 编辑器的终端用户与开发者  
> 最近更新：同步内部标题补全与表格辅助逻辑

---

## 1. 快速开始

把光标放入编辑区域即可开始书写 Markdown。无需手动保存（如果应用开启自动保存或预览轮询，内容会被自动读取）。

建议使用下列最常用快捷键提升效率：

- **Cmd/Ctrl + B**：加粗（`**text**`）
- **Cmd/Ctrl + I**：斜体（`*text*`）
- **Cmd/Ctrl + U**：下划线（`<u>text</u>`）
- **Cmd/Ctrl + K**：插入/包裹链接（`[选中文本]()` 或 `[]()`）
- **Tab / Shift+Tab**：在表格单元或普通缩进之间智能导航 / 缩进

---

## 2. 功能总览

| 功能 | 描述 | 触发方式 | 备注 |
|------|------|----------|------|
| 行号整行选择 | 点击行号选中整行；拖拽可跨行 | 单击 / 按下并拖动行号区域 | 支持 Shift+点击扩展选择 |
| 拖拽自动滚动 | 行号拖拽到上下边缘自动滚动 | 拖拽时靠近上下区域 | 便于大量行选择 |
| Markdown 行内格式快捷键 | 粗体、斜体、下划线、链接 | Cmd/Ctrl + B/I/U/K | 可多光标生效 |
| 链接内部标题补全 | 链接括号内输入 `#` 后出现标题锚点 | `[...](#` 输入 `#` | Tab/Enter 接受 |
| 标题锚点 slug 生成 | 根据标题文本生成 `#slug` | 自动 | 去除特殊符号，空格转 `-` |
| 表格自动分隔行补全 | 表头回车自动插入分隔行与空数据行 | 在第一行表头按 Enter | 识别列数 |
| 表格行内导航 | Tab 到下一单元格，末尾自动创建新行 | 表格行内 Tab | Shift+Tab 反向 |
| 快速插入 2×2 表格 | 生成表格骨架 | Cmd/Ctrl + Alt + T | 光标进入首单元格 |
| Emoji 简易补全（示例） | 输入关键字建议 emoji | 输入 `smile` 等（示例） | 可扩展或关闭 |
| 自动高亮 | 标题、链接、代码、列表等语法高亮 | 输入即触发 | 主题支持浅/深色 |

---

## 3. 行号选择与拖拽

- 单击行号：选中该行（包含换行；最后一行不补尾换行）。
- Shift+单击：扩展选择到新的行范围。
- 按住行号拖动：动态扩展选择，可连续跨行；靠近编辑区顶部/底部自动缓慢滚动。
- 设计选择范围时，内部实现使用“下一行起始位置”确保复制/删除整行体验一致。

👉 用途：快速移动/复制/删除多行；批量格式化或包裹。

---

## 4. 快捷键详解

| 快捷键 | 作用 | 行为细节 |
|--------|------|----------|
| Cmd/Ctrl + B | 加粗 | 无选区：插入成 `****` 光标居中；有选区：包裹或取消包裹并保留内容 |
| Cmd/Ctrl + I | 斜体 | 同上，使用 `*` 包裹 |
| Cmd/Ctrl + U | 下划线 | 使用 HTML `<u>` 标签包裹，可再次按键取消 |
| Cmd/Ctrl + K | 链接 | 无选区插入 `[]()` 并将光标放在 `[]` 中；有选区包裹为 `[text]()` 并光标置于 `()` 中 |
| Cmd/Ctrl + Alt + T | 插入 2×2 表格 | 表头、分隔行、1 行空数据；光标在第一格 |
| Tab | 缩进或跳转 | 表格：跳单元格；正常：自定义缩进逻辑（多行缩进 / 单点插入 `\t`）|
| Shift+Tab | 反缩进/后退 | 表格：跳到上一单元格；正常：反缩进 |
| Enter | 新行 / 表格智能增加 | 表格表头：自动补分隔行+空行；其他表格行：增加新空行 |

---

## 5. 链接内部标题补全

在链接模式内（形如 `[标题](光标在这里)`）输入 `#`：

1. 补全面板自动列出文档内全部 H1~H6 标题。左侧徽标显示层级（H1/H2…）。
2. 输入继续过滤：依据 slug（例如 “快速 开始” → `#快速-开始`）。
3. 选择后插入格式：`[#slug]` 中的括号保留你输入的 `#`，补全仅替换其后的部分。
4. slug 规则：
   - 去除：标点符号、特殊字符。
   - 空白折叠为单个 `-`。
   - 多个连续 `-` 合并为一个。

🛠 扩展空间：后续可支持重复标题自动加后缀 `-2`、`-3`，或与渲染端保持完全一致的 slug 算法。

---

## 6. 表格辅助功能细节

### 6.1 自动分隔行插入逻辑

在第一行表头（含 `|` 且不是纯分隔行）按 Enter：

- 若下一行不是分隔行，则插入：
  - 分隔行：每列生成 `| --- |`
  - 新空行：`|   |   |...`

### 6.2 单元格导航

- Tab：
  - 当前行下一格存在：跳过去。
  - 当前行末尾：若下一行是数据行或分隔+数据行组合，则跳到下一行第一格；否则自动创建新空行。
- Shift+Tab：
  - 跳到上一格；若在第一格并存在上一数据行，跳到上一行最后一格。

### 6.3 新行生成规范

- 保持标准表格格式：首尾使用竖线。
- 新空行每列以三个空格占位（可根据实际再优化为单空格）。

### 6.4 插入模板

- 快捷键：Cmd/Ctrl + Alt + T → 默认 2×2。
- 行结构示例：

```markdown
|   |   |
| --- | --- |
|   |   |
```

### 6.5 已考虑的边界

| 场景 | 处理 |
|------|------|
| 代码块内 ``` | 禁止触发表格辅助 |
| 仅分隔行 | 不触发 header Enter 逻辑 |
| 无前导行(缺少前导 \|) | 兼容统计列数；新行使用标准格式 |
| 尾行 Tab | 自动创建新行并跳入首单元格 |

---
## 7. Emoji 简易补全（示例性质）

输入部分关键字（如 `smile`、`fire`、`warning`）可出现示例 Emoji 补全。此功能仅示范扩展方式，可按需：

- 扩充表
- 接入系统自定义符号库
- 或完全移除

---
## 8. 性能与行为说明

- 编辑器不在 JS 侧做输入节流，交由后端（如 Java 轮询端）做去抖与预览更新。
- 行号选择采用捕获阶段监听，减少与内容区事件竞争。
- 大文件中表格辅助与标题收集为线性扫描（O(n) 行），目前对中等篇幅 Markdown 性能影响极低；若后续出现超大文件可加缓存或增量更新。

---
## 9. 常见问题 (FAQ)

| 问题 | 原因 | 解决 |
|------|------|------|
| 链接里输入 `#` 没有补全 | 光标不在 `[]()` 的括号内 | 确认格式为 `[text](#|这里)` |
| Tab 没跳单元格而是缩进 | 当前行不是表格行或补全面板正在显示 | 确认行含 `|` 且不是分隔行；或先关闭补全面板 |
| 标题重复时 slug 一样 | 尚未实现冲突后缀策略 | 规划中，可通过算法加 `-2` |
| 行号点击无效 | 非左侧 gutter 或事件被遮挡 | 检查是否有覆盖层遮挡编辑器 |

---
## 10. Roadmap（后续计划）

| 阶段 | 计划特性 | 简述 |
|------|----------|------|
| 即将 | 滚动同步预览 | 编辑区滚动定位预览对应块；后续反向同步 |
| 即将 | 任务列表切换 | `- [ ]` 与 `- [x]` 状态切换快捷键与点击支持 |
| 拓展 | 图片与附件处理 | 粘贴/拖拽文件 -> 生成资源路径与 Markdown 引用 |
| 拓展 | 表格列对齐快捷键 | 快速在 `:---`, `---:`, `:---:` 间切换 |
| 拓展 | 标题锚点冲突消解 | 自动添加递增后缀保持唯一性 |
| 拓展 | 多选区批量格式化 | 对多个选区同时应用粗体/斜体等 |

---
## 11. 自定义与扩展

- 样式：可在 `markdown-highlight.css` 中调整配色与字体（浅色/深色跟随系统）。
- 补全：在 `editor_entry.js` 中的 `autocompletion({override:[...]})` 扩展或替换源。
- 表格逻辑：可将当前脚本抽象为独立 ViewPlugin 以便模块化维护与测试。
- 主题：可后续接入 CodeMirror 官方主题包（如 oneDark）。

---
## 12. 技术实现要点速览

| 部分 | 技术点 | 说明 |
|------|--------|------|
| Gutter 选择 | ViewPlugin + 捕获事件 | 直接监听 mousedown/move/up 实现拖拽与选区刷新 |
| 格式快捷键 | changeByRange + 事务 | 统一处理光标/选区包裹与反包裹 |
| 链接补全 | 自定义 completion source | 根据光标上下文匹配链接括号与 `#` 起始 |
| 表格辅助 | 正则 + 行扫描 | 动态识别表格块、列数与插入行生成 |
| Tab 行为 | 条件分支优先级 | 补全面板 > 表格导航 > 缩进插入 |

---
## 13. 小贴士

- 先输入表头再按 Enter，可一次性生成分隔行和第一条数据行。
- 链接内部补全只在括号里出现，不会骚扰普通写作。
- 如果觉得单元格占位过宽，可将 `buildEmptyRow` 中的三个空格改为一个空格。
- 大量标题时，可考虑增加搜索或折叠功能（后续扩展）。

---
## 14. 反馈与改进

遇到以下场景欢迎反馈：

- 超大文档下标题或表格补全性能不足。
- 某些特殊 Markdown 语法组合导致识别失败（例如引用里嵌套表格）。
- 希望新增的快捷键或补全类别（例：脚注、公式块、代码语言提示增强）。

---
## 15. 结语

本说明文档旨在让你充分理解 QuickOutline 内置 Markdown 编辑器的能力与扩展空间。随着功能增长，文档会继续补充。如有建议，欢迎直接在仓库的 issue 或内部反馈渠道提出。

> 下一步建议：滚动同步预览完成后，在此文档新增“实时预览”章节。
